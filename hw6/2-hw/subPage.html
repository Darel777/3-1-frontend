<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <title>查看大图</title>
        <link href="css/subPage.css" type="text/css" rel="stylesheet">
    </head>

<body>
    <header>
        <nav>
            <ul class="menu">
                    <li><button id="skin" onclick="home()">回到主页</button></li>
                    <li><button id="skin" onclick="getAuth()">查看用户</button></li>
                    <li><button id="skin" onclick="exitAuth()">退出登录</button></li>
            </ul>
        </nav>
    </header>
<!-- 原图 -->
<div id="original"></div>
<!-- 可见水印SVG -->
<div id="SVG">
    <div id="watermark"><img src="pics/16.jpg" alt="16.jpg"></div>
    <div id="watermarkgraph"></div>
</div>
<!-- 不可见水印 -->
<div id="fuliye">
    <canvas id="fourier" width="1024" height="768"></canvas>
</div>
</body>
</html>
<script src="js/cryptostego.min.js"></script>
<script>
    var link = "pics/" + window.location.search.substring(1,window.location.search.indexOf("&"));
document.querySelector('#original').innerHTML = "<a href=" + link + " />" + "<img src=" + link + " alt=" + link + " />" + "</a>";
const svgStr = `<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300">
                  <text x="0" y="200" 
                    text-anchor="middle" 
                    fill="#ccc" 
                    fill-opacity="0.3" 
                    transform="rotate(-45, 30 0)" 
                    style="font-size: 30px;"\
                  >{content}</text>
                </svg>`
const watermark = `url("data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent( svgStr.replace(/\{content\}/g, "201250123 刘晓旭") )))}")`
document.querySelector('#watermark').style.backgroundImage = watermark
document.querySelector('#watermarkgraph').innerHTML = "<img src=" + link + " alt=" + link + " />";
window.onload = function (){
    var mycanvas = document.getElementById('fourier')
    var ctx = mycanvas.getContext('2d')
    var img = new Image();
    img.src = link
    img.onload = function(){
        ctx.drawImage(this,0,0,1024,768);
        writeMsgToCanvas('fourier',"201250123","",0);
    }
    var urlParams = window.location.href;
      var context = urlParams.substring(urlParams.indexOf("=")+1,urlParams.length)
      setCookie(String(context),"randomaccess",7)

}
function home(){
  var urlParams = window.location.href;
  var context = urlParams.substring(urlParams.indexOf("=")+1,urlParams.length)
  window.location.href="index.html?"+"username="+context
}
function getAuth(){
  var urlParams = window.location.href;
  var context = urlParams.substring(urlParams.indexOf("=")+1,urlParams.length)
  let cookie=getCookie(String(context))
  if(context.charAt(4)!==':'){
      alert("已登录，当前帐号为："+context)
  }else{
      alert("未登录！")
  }
}
function exitAuth(){
  var urlParams = window.location.href;
      var context = urlParams.substring(urlParams.indexOf("=")+1,urlParams.length)
      delCookie(context)
      window.location.href="login.html"      
}
/**
 * 设置cookie
 **/
 function setCookie(name, value, day) {
  if(typeof day == 'number'){
    let date = new Date();
    date.setDate(date.getDate() + day);
    document.cookie = name + '=' + value + ';expires=' + date;     
  }
};
/**
 * 获取cookie
 **/
function getCookie(name) {
    let reg = RegExp(name + '=([^;]+)');
    let arr = document.cookie.match(reg);
    if (arr) {
        return arr[1];
    } else {
        return '';
    }
};
/**
 * 删除cookie
 **/
function delCookie(name) {
    setCookie(name, null, -1);
};
</script>